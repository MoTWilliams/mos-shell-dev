// main loop and command dispatcher
